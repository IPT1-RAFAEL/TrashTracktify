<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TrashTracktify — Driver Map</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="css/driver.css" />
</head>
<body class="locked"> <!-- Start locked to show login initially -->

  <header class="top-nav" role="banner">
    <div class="top-nav-inner">
      <div class="brand">
        <img src="img/garbage-truck.png" alt="" aria-hidden="true">
        <span class="app-title">TrashTracktify</span>
      </div>
    </div>

    <div class="driver-controls">
      <label class="switch">
        <input id="trackingToggle" type="checkbox" />
        <span class="slider"></span>
      </label>
      <span id="trackingLabel">STOP</span>
    </div>
  </header>

  <main class="map-main">
    <div id="map"></div>
  </main>

  <!-- DARK MODE STATUS PANEL -->
  <div class="status-panel" id="statusPanel">
    <button class="status-header" id="statusDropdown">Truck Status ▼</button>
    <div class="status-options" id="statusOptions">
      <button data-value="25">25%</button>
      <button data-value="50">50%</button>
      <button data-value="75">75%</button>
      <button data-value="100">100%</button>
      <button id="statusFinished">Finished</button>
    </div>
  </div>

  <nav class="bottom-nav">
    <a class="nav-item active" href="driver.html">
      <img src="img/map.png" alt="Map">
      <span>Map</span>
    </a>
    <a class="nav-item" href="driver-schedule.html">
      <img src="img/cal.png" alt="Schedule">
      <span>Schedule</span>
    </a>
  </nav>

  <!-- === POPUPS === -->

  <!-- 1. Login Popup -->
  <div id="loginPopup" class="popup show"> <!-- Start with 'show' class -->
    <div class="popup-content">
      <img src="img/truck.png" alt="Truck Icon" class="popup-icon">
      <h1>Driver Login</h1>
      <form id="loginForm">
        <input type="text" id="driverName" name="driverName" placeholder="Driver Name" required autocomplete="username">
        <input type="password" id="driverPassword" name="driverPassword" placeholder="Password" required autocomplete="current-password">
        <button type="submit" id="loginBtn" class="primary-btn">Login</button>
        <div class="popup-links">
          <button type="button" class="link-btn" id="showRegisterPopupBtn">Register New Driver</button>
          <button type="button" class="link-btn" id="showForgotPasswordBtn">Forgot Password?</button>
        </div>
        <div id="loginMsg" class="msg"></div>
      </form>
    </div>
  </div>

  <!-- 2. Registration Popup -->
  <div id="registerPopup" class="popup">
    <div class="popup-content">
       <img src="img/truck.png" alt="Truck Icon" class="popup-icon">
       <h1>Driver Registration</h1>
       <form id="registerForm">
         <input type="text" id="regName" name="regName" placeholder="Full Name" required autocomplete="name">
         <input type="tel" id="regPhone" name="regPhone" placeholder="Phone (09xxxxxxxxx)" required autocomplete="tel" pattern="09[0-9]{9}">
         <select id="regBarangay" name="regBarangay" required>
            <option value="" disabled selected>Select Assigned Barangay</option>
            <option value="Tugatog">Tugatog</option>
            <option value="Acacia">Acacia</option>
            <option value="Tinajeros">Tinajeros</option>
         </select>
         <input type="password" id="regPassword" name="regPassword" placeholder="Create Password (min 6 chars)" required autocomplete="new-password" minlength="6">
         <button type="submit" id="registerBtn" class="primary-btn">Register</button>
         <div class="popup-links">
           <button type="button" class="link-btn" id="backToLoginFromRegister">Back to Login</button>
         </div>
         <div id="registerMsg" class="msg"></div>
       </form>
    </div>
  </div>

  <!-- 3. Forgot Password Popup -->
  <div id="forgotPasswordPopup" class="popup">
     <div class="popup-content">
       <img src="img/truck.png" alt="Truck Icon" class="popup-icon">
       <h1>Reset Password</h1>
       <form id="forgotPasswordForm">
         <p class="desc">Enter your phone number to receive reset instructions (functionality not implemented yet).</p>
         <input type="tel" id="resetPhone" name="resetPhone" placeholder="Phone (09xxxxxxxxx)" required autocomplete="tel" pattern="09[0-9]{9}">
         <button type="submit" id="sendResetBtn" class="primary-btn">Send Reset Link</button>
         <div class="popup-links">
            <button type="button" class="link-btn" id="backToLoginFromForgot">Back to Login</button>
         </div>
         <div id="forgotMsg" class="msg"></div>
       </form>
     </div>
   </div>

  <!-- === END POPUPS === -->


  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script src="https://unpkg.com/@turf/turf/turf.min.js"></script>
  <script src="js/driver.js"></script>
</body>
</html>
